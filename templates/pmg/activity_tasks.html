{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/myStyle.css') }}">
{% endblock head %}

{% block body %}
<div class="list-container">
    <div class="list-header">
        <h3>{{ activity.name }} - Tasks</h3>
        <button class="new-button" onclick="showNewTaskForm()">New Task</button>
    </div>
    <div class="list-content">
        {% if tasks %}
            {% for task in tasks %}
                <div class="list-item">{{ task.task }}
                    <!-- Checkbox for marking the task as completed -->
                     <form method="POST" action="{{ url_for('pmg.update_task', activity_id=activity.id, task_id=task.id) }}">
                        <input type="checkbox" name="completed" value="list" onchange="this.form.submit()" {% if task.completed %}checked{% endif %}>
                    </form>
                </div>
            {% endfor %}
        {% else %}
            <p>No tasks found for this activity.</p>
        {% endif %}
    </div>
</div>
<!-- Form to add a new task -->
<div class="add-form-container">
    <form action="{{ url_for('pmg.add_task', activity_id=activity.id) }}" method="POST">
        <input type="text" name="task_name" placeholder="New Task Name" required>
        <button type="submit">Add Task</button>
    </form>
</div>

<script>
    function showNewTaskForm() {
        // Show form to create new task
    }

    // Function to handle the task completion toggle
function updateTaskStatus(taskId, isCompleted) {
    console.log(`Task ID: ${taskId}, Completed: ${isCompleted}`);  // Lägg till denna rad för felsökning

    fetch('/pmg/update-task-status/' + taskId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken()  // Om CSRF-skydd används
        },
        body: JSON.stringify({
            completed: isCompleted
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Task updated successfully');
        } else {
            console.error('Error updating task:', data.error);
        }
    })
    .catch(error => {
        console.error('Network error:', error);
    });
}


function getCSRFToken() {
    return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
}
</script>

{% endblock body %}
