{% extends 'base.html' %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/myStyle.css') }}">
    <style>
    .container {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        align-items: center; /* Centrera elementen horisontellt */
        justify-content: center; /* Centrera elementen vertikalt */
    }
    </style>

{% endblock head %}
{% block body %}
<div class="container">
    <div class="todo-list" id="todo-list-{{ activity.id }}">
        <h4>{{ activity.name }} To-Do</h4>
        <ul>
        {% for task in tasks %}
            <li class="{% if task.completed %}completed-task{% endif %}">
                {{ task.task }}
                <form method="POST" action="{{ url_for('pmg.update_task', activity_id=activity.id, task_id=task.id) }}">
                    <input type="hidden" name="origin" value="todo_list">
                    <input type="checkbox" class="task-checkbox" name="completed"
                        onchange="this.form.submit()"  {% if task.completed %} checked {% endif %}>
                </form>
            </li>
        {% endfor %}
        </ul>
         <form action="{{ url_for('pmg.add_task', activity_id=activity.id) }}" method="POST">
            <input type="hidden" name="actId" value="{{ activity.id }}">
            <input type="hidden" name="origin" value="focus">
            <input type="text" name="task_name" placeholder="Enter new task" required>
            <button onclick="" type="submit" name="action" value="addTodo">Add Task</button>
        </form>
    </div>
    <form method="POST">
        <div id="completed-form" class="form-container" style="display:none;">
            <input type="text" id="aID" name="aID" >
            <input type="text" id="aDate" name="aDate" value="{{ current_date }}">
            <input type="text" id="start" name="start">
            <input type="text" id="end" name="end">
            <input type="number" id="score" name="score">
            <div class="button-center" id="complete-form" style="display:none;">
                <button type="submit" onclick="turnOff" name="action" id="save-btn" class="button-style" value="save-score">Save</button>
            </div>
        </div>
    </form>
    <div class="button-center" style="width:10%">
        <button id="stopButton" class="button-style" style="background-color:red" onclick="stopActivity()">Stop</button>
        <button id="continueButton" class="button-style" style="display: none; background-color: green" onclick="">Continue</button>
    </div>
</div>

<div class="activity-notes" style="display:flex; flex-direction: column; width:20%; justify-content:center;align-items: flex-end; text-align: left">
 {% if activity_notes %}
    <div class="right-container">
        <h3>Activity notes</h3>
        {% for note in activity_notes %}
        <div class="collapsed-notes">
            <form method="POST" action="{{ url_for('pmg.update_note', note_id=note.id) }}">
                <div>
                    <h5>{{ note.title }}</h5>
                    <textarea name="content" rows="3">{{ note.content }}</textarea>
                </div>
                <button type="submit" class="button-style">Save</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <div class="new-notebook-form">
        <h4>Create a New Notebook</h4>
        <form method="POST" action="{{ url_for('pmg.create_notebook', activity_id=activity.id) }}">
            <div>
                <label for="notebook-title">Notebook Title:</label>
                <input type="text" id="notebook-title" name="title" required>
            </div>
            <button type="submit" class="button-style">Create Notebook</button>
        </form>
    </div>
</div>
<script src="{{ url_for('static', filename='common_functions.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

    if (localStorage.getItem('active') === 'true') {
        console.log("En aktivitet är redan aktiv.");
        return;  // Avsluta om en aktivitet redan pågår
    }

    // Lägg till event listeners för uppgifter
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const taskId = this.dataset.taskId;
            const isCompleted = this.checked;
            updateTaskStatus(taskId, isCompleted);
        });
    });
});

function updateTaskStatus(taskId, isCompleted) {
    fetch(`/tasks/${taskId}/update`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken()  // Om du använder CSRF-skydd
        },
        body: JSON.stringify({
            completed: isCompleted
        }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Task updated successfully');
        } else {
            console.error('Error updating task:', data.error);
        }
    })
    .catch(error => {
        console.error('Network error:', error);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('textarea').forEach(textarea => {
        textarea.addEventListener('input', function() {
            // Visa spara-knappen när texten ändras
            const saveButton = this.closest('form').querySelector('button[type="submit"]');
            saveButton.style.display = 'inline-block';  // Visa knappen
        });
    });
});

function turnOff() {
    localStorage.setItem(active, false);
}
</script>
{% endblock body %}