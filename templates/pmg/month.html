{% extends 'base.html' %}

{% block head %}
    <style>
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 20px;
            height: 100vh;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-header {
            grid-column: span 7;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .day-header, .day {
            text-align: center;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #fff;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
        }

        .day-header {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        .day.today {
            background-color: #ffeb3b;
        }

        .day.clickable {
            cursor: pointer;
        }

        .day.other-month {
            background-color: #f9f9f9;
        }

        .expand {
            animation: expand 0.5s forwards;
        }

        @keyframes expand {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(1.1);
            }
        }
    </style>
{% endblock head %}

{% block body %}
<div class="calendar-container">
    <div class="calendar-grid">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)"> < </button>
            <span>{{ month_name }} {{ year }}</span>
            <button onclick="changeMonth(1)"> > </button>
        </div>
        <div class="day-header">Måndag</div>
        <div class="day-header">Tisdag</div>
        <div class="day-header">Onsdag</div>
        <div class="day-header">Torsdag</div>
        <div class="day-header">Fredag</div>
        <div class="day-header">Lördag</div>
        <div class="day-header">Söndag</div>
        {% for week in weeks %}
            {% for day in week %}
            <div class="day {{ 'clickable' if day.current_month else 'other-month' }} {{ 'today' if day.date.strftime('%Y-%m-%d') == today_date.strftime('%Y-%m-%d') else '' }}"
                 data-date="{{ day.date.strftime('%Y-%m-%d') }}" onclick="onDateClick(this, '{{ day.date.strftime('%Y-%m-%d') }}')">
                <div class="streak-count">
                    {% if day.current_month %}
                        {% set dag = dag_data.get(day.date.strftime('%Y-%m-%d')) %}
                        {% if dag %}
                            {{ dag.completed_streaks }} / {{ dag.total_streaks }}
                        {% else %}
                            0 / 0
                        {% endif %}
                    {% else %}
                        &nbsp;
                    {% endif %}
                </div>
                <div class="day-date">{{ day.day }}</div>
                <div class="total-points">
                    {% if day.current_month %}
                        {% set dag = dag_data.get(day.date.strftime('%Y-%m-%d')) %}
                        {% if dag %}
                            {{ dag.total_points }} P
                        {% else %}
                            0 P
                        {% endif %}
                    {% else %}
                        &nbsp;
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% endfor %}
    </div>
</div>
<script>
function onDateClick(element, date) {
    if (!element.classList.contains('other-month')) {
        element.classList.add('expand');
        setTimeout(function() {
            window.location.href = '/pmg/myday/' + date;
        }, 500); // Väntar på att animationen ska slutföras innan omdirigering
    }
}

function changeMonth(change) {
    var currentYear = {{ year }};
    var currentMonth = {{ month }};
    var newDate = new Date(currentYear, currentMonth - 1 + change);
    window.location.href = `/pmg/month/${newDate.getFullYear()}/${newDate.getMonth() + 1}`;
}

document.addEventListener('DOMContentLoaded', function() {
    const today = '{{ today_date }}';
    const todayCell = document.querySelector(`.day[data-date="${today}"]`);
    if (todayCell) {
        todayCell.classList.add('today');
    }
});
</script>
{% endblock body %}